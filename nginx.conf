# AACSB Application NGINX Configuration
# Add this to your server block in the main nginx config

# AACSB Backend API
location /aacsb/api {
    proxy_pass http://127.0.0.1:8001/aacsb/api;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 300s;
    proxy_connect_timeout 75s;
}

# AACSB Static Files
location /aacsb/static {
    alias /var/www/aacsb/frontend;
    expires 1d;
    add_header Cache-Control "public, immutable";
}

# AACSB Login Page
location = /aacsb/login {
    alias /var/www/aacsb/frontend/index.html;
    default_type text/html;
}

# AACSB AOL Section
location /aacsb/aol {
    # Try to serve static file first, then proxy to FastAPI for dynamic routes
    try_files /aacsb/frontend/aol$uri /aacsb/frontend/aol$uri/index.html @aacsb_backend;
}

# Programme detail pages (dynamic routes)
location ~ ^/aacsb/aol/programme/[0-9]+$ {
    proxy_pass http://127.0.0.1:8001;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# AACSB Research Section (placeholder)
location /aacsb/research {
    proxy_pass http://127.0.0.1:8001/aacsb/research;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Auth endpoints (magic link verification)
location /aacsb/auth {
    proxy_pass http://127.0.0.1:8001/aacsb/api/auth;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Fallback to backend
location @aacsb_backend {
    proxy_pass http://127.0.0.1:8001;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}

# Root redirect
location = /aacsb {
    return 301 /aacsb/aol;
}

location = /aacsb/ {
    return 301 /aacsb/aol;
}
